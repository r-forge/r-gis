# Author: Robert J. Hijmans
# Date:  October 2008
# Version 0.9
# Licence GPL v3


.uniqueNames <- function(x, sep='.') {
	y <- as.matrix(table(x))
	y <- y[y[,1] > 1, ,drop=F]
	if (nrow(y) > 0) {
		y <- rownames(y)
		for (i in 1:length(y)) {
			j <- which(x==y[i])
			x[j] <- paste(x[j], sep, 1:length(j), sep='')
		}
	}
	x
}



.uniqueNames <- function(x, sep='.') {
	y <- as.matrix(table(x))
	y <- y[y[,1] > 1, ,drop=F]
	if (nrow(y) > 0) {
		y <- rownames(y)
		for (i in 1:length(y)) {
			j <- which(x==y[i])
			x[j] <- paste(x[j], sep, 1:length(j), sep='')
		}
	}
	x
}

validNames <- function(x, prefix='lyr') {
	x <- trim(as.character(x))
	x[is.na(x)] <- ""
#	if (.standardnames()) {
		x[x==''] <- prefix
		x <- make.names(x, unique=FALSE)
#	}
	.uniqueNames(x)
}




setMethod('labels', signature(object='GeoRaster'), 
	function(object) { 
		names(object)
	}
)

	
setMethod('names', signature(x='GeoRaster'), 
	function(x) { 
		x@ptr$names
	}
)


setMethod('names<-', signature(x='GeoRaster'), 
	function(x, value)  {
		nl <- nlayer(x)
		if (length(value) != nl) {
			stop('incorrect number of layer names')
		}
		v <- validNames(value)
		if (!all(v == value)) {
			warning('names changed to make the valid')
		}
		x@ptr$names <- v
		return(x)
	}
)

